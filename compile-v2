#!/bin/bash
set -e

# FastLED Enhanced Compilation System v2
# This script provides the new incremental build system with optimized path handling

# Function to find Python executable
find_python() {
    if command -v python3 &> /dev/null; then
        echo "python3"
    elif command -v python &> /dev/null; then
        echo "python"
    else
        echo "Python not found. Please install Python 3."
        exit 1
    fi
}

# Check if uv is installed, if not, install it
if ! command -v uv &> /dev/null; then
    echo "uv command not found. Installing uv..."
    PYTHON=$(find_python)
    $PYTHON -m pip install uv
fi

cd "$(dirname "$0")"

# if .venv not found
if [ ! -d .venv ]; then
    # create virtual environment
    ./install
fi

# Default to interactive mode if no arguments provided
interactive_stmt=""
if [ $# -eq 0 ]; then
    interactive_stmt="--interactive"
fi

# Display banner for v2 system
echo "ðŸš€ FastLED Enhanced Compilation System v2"
echo "   âœ¨ Features: Incremental builds, better paths, smart caching"
echo ""

# Run the enhanced compilation system
exec uv run ci/ci-compile-v2.py $interactive_stmt "$@"
